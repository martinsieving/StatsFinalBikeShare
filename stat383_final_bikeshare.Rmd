---
title: "STAT383 Final Project: Bikeshare"
output: html_notebook
---

Referencing key packages:
```{r}

library(tidyverse)
library(janitor)
library(here)
library(rwunderground)
library(openmeteo)
library(ggplot2)
library(geosphere)

```

Loading raw Seoul bikeshare date (hourly):
```{r}

thisfile=here("SeoulBikeData.csv")

bikes_raw = read_csv(thisfile) %>% clean_names()

```

Removing outlier days (holidays and nonfunctioning), removing variables not relevant to regression, and combining precipitation variables by equivalent rain height (NSSL 1mm rain = 13mm snow) (eql_rain_mm):
```{r}

bikes_filter = bikes_raw |> 
  filter(holiday == "No Holiday", functioning_day == "Yes") |> 
  select(-date, -dew_point_temperature, -solar_radiation_mj_m2, -seasons, -holiday, -functioning_day)

bikes_total = bikes_filter |> 
  mutate(eql_rain_mm = rainfall_mm + snowfall_cm/10/13) |> 
  select(-rainfall_mm, -snowfall_cm)

glimpse(bikes_total)

```

Building linear regression model for ridership as a function of the following variables- hour, temperature, humidity, windspeed, visibility, and precipitation:
```{r}

regression_total = lm(data = bikes_total, rented_bike_count ~ hour + temperature_c + humidity_percent + wind_speed_m_s + visibility_10m + eql_rain_mm)

summary(regression_total) 

# This builds a regression model to predict total hourly ridership as with all variables as inputs, as opposed to drawing intependent trends for each variable.

```

Independent regression model for ridership vs hour of day:
```{r}

reg_hour = lm(data = bikes_total, rented_bike_count ~ hour)
summary(reg_hour) 

hour_plot = ggplot(data = bikes_total,
                   aes(x = hour, y = rented_bike_count)) +
            geom_point(alpha = 0.1, color = "darkgrey") +
            geom_smooth(color = "green", linewidth = 1.5) +
            geom_abline(intercept = 277.1531,
                        slope = 40.1596, color = "red",
                        linetype = "dashed",linewidth=1.5) +
            theme_minimal() +
            labs(x = "Hour of Day",
                 y = "Hourly Total Count of Rented Bikes",
                 title = "Ridership vs Hour of Day") +
  ylim(0,3000)
                   
hour_plot

```

Independent regression model for ridership vs temperature:
```{r}

reg_temp = lm(data = bikes_total, rented_bike_count ~ temperature_c)
summary(reg_temp) 

temp_plot = ggplot(data = bikes_total,
                   aes(x = temperature_c, y = rented_bike_count)) +
            geom_point(alpha = 0.1, color = "darkgrey") +
            geom_smooth(color = "green", linewidth = 1.5) +
            geom_abline(intercept = 358.7187,
                        slope = 29.435, color = "red",
                        linetype = "dashed",linewidth=1.5) +
            theme_minimal() +
            labs(x = "Hourly Temperature (Deg C)",
                 y = "Hourly Total Count of Rented Bikes",
                 title = "Ridership vs Temperature") +
  ylim(0,3000)
                   
temp_plot

```

Independent regression model for ridership vs humidity:
```{r}

reg_hum = lm(data = bikes_total, rented_bike_count ~ humidity_percent)
summary(reg_hum) 

hum_plot = ggplot(data = bikes_total,
                   aes(x = humidity_percent, y = rented_bike_count)) +
            geom_point(alpha = 0.1, color = "darkgrey") +
            geom_smooth(color = "green", linewidth = 1.5) +
            geom_abline(intercept = 1131.6885,
                        slope = -6.7230, color = "red",
                        linetype = "dashed",linewidth=1.5) +
            theme_minimal() +
            labs(x = "Hourly Percent Humidity",
                 y = "Hourly Total Count of Rented Bikes",
                 title = "Ridership vs Humidity") +
  ylim(0,3000)
                   
hum_plot

```

Independent regression model for ridership vs windspeed:
```{r}

reg_wind = lm(data = bikes_total, rented_bike_count ~ wind_speed_m_s)
summary(reg_wind) 

wind_plot = ggplot(data = bikes_total,
                   aes(x = wind_speed_m_s, y = rented_bike_count)) +
            geom_point(alpha = 0.1, color = "darkgrey") +
            geom_smooth(color = "green", linewidth = 1.5) +
            geom_abline(intercept = 593.025,
                        slope = 85.106, color = "red",
                        linetype = "dashed",linewidth=1.5) +
            theme_minimal() +
            labs(x = "Hourly Wind Speed (m/s)",
                 y = "Hourly Total Count of Rented Bikes",
                 title = "Ridership vs Wind Speed") +
  xlim(0,5) +
  ylim(0,3000)
                   
wind_plot

```

Independent regression model for ridership vs visibility:
```{r}
bikes_total_2 = bikes_total |> 
  mutate(visibility_m = visibility_10m * 10) |> 
  select(-visibility_10m)

reg_vis = lm(data = bikes_total_2, rented_bike_count ~ visibility_m)
summary(reg_vis) 

vis_plot = ggplot(data = bikes_total_2,
                   aes(x = visibility_m, y = rented_bike_count)) +
            geom_point(alpha = 0.1, color = "darkgrey") +
            geom_smooth(color = "green", linewidth = 1.5) +
            geom_abline(intercept = 4.028e+02,
                        slope = 2.352e-02, color = "red",
                        linetype = "dashed",linewidth=1.5) +
            theme_minimal() +
            labs(x = "Visibility (meters)",
                 y = "Hourly Total Count of Rented Bikes",
                 title = "Ridership vs Visibility") +
  ylim(0,3000)
                   
vis_plot

```

Independent regression model for ridership vs precipitation:
```{r}

reg_prec = lm(data = bikes_total, rented_bike_count ~ eql_rain_mm)
summary(reg_prec) 

prec_plot = ggplot(data = bikes_total,
                   aes(x = eql_rain_mm, y = rented_bike_count)) +
            geom_point(alpha = 0.1, color = "darkgrey") +
            geom_smooth(color = "green", linewidth = 1.5) +
            geom_abline(intercept = 750.591,
                        slope = -73.849, color = "red",
                        linetype = "dashed",linewidth=1.5) +
            theme_minimal() +
            labs(x = "Precipitation (mm equivalent rainfall)",
                 y = "Hourly Total Count of Rented Bikes",
                 title = "Ridership vs Precipitation") +
  xlim(0,5) +
  ylim(0,3000)
                   
prec_plot

```



